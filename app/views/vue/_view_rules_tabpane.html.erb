<div class="content">
<h4>Security Groups associated with #{{physical_id}}</h4>

<div class="row">
  <div class="span*">
    <table class="table table-bordered text-center">
      <thead>
      <!--Top headers-->
      <tr>
        <th rowspan="2">Description</th>
        <th rowspan="2">Group ID</th>
        <th class="text-center" colspan="3">Inbound</th>
        <th class="text-center" colspan="3">Outbound</th>
      </tr>
      <!--For inbound and outbound subheaders-->
      <tr>
        <!--<th>Type</th>-->
        <th>Protocol</th>
        <th>Port Range</th>
        <th>Source</th>
        <!--<th>Type</th>-->
        <th>Protocol</th>
        <th>Port Range</th>
        <th>Source</th>
      </tr>
      </thead>
      <!--Contents-->
      <tbody>
      <template v-for="rule in rules_summary" track-by="$index">
        <tr>
          <th v-if="rule.ip_permissions.length > rule.ip_permissions_egress.length" style="width: 20%" rowspan="{{rule.ip_permissions.length +1}}">{{rule.description}}</th>
          <th v-else rowspan="{{rule.ip_permissions_egress.length +1}}">{{rule.description}}</th>
          <th v-if="rule.ip_permissions.length > rule.ip_permissions_egress.length" rowspan="{{rule.ip_permissions.length+1}}">{{rule.group_id}}</th>
          <th v-else rowspan="{{rule.ip_permissions_egress.length+1}}">{{rule.group_id}}</th>
        </tr>

          <!--If inbound contents is greater than outbound contents, inbound will be the base loop-->
          <template v-if="rule.ip_permissions.length > rule.ip_permissions_egress.length">
            <template v-for="(index, inbound) in rule.ip_permissions">
              <template v-if="index == 0">
                <!--First inbound-->
                <tr>
                  <td>{{inbound.ip_protocol}}</td>
                  <td v-if="inbound.from_port === inbound.to_port">{{inbound.from_port}}</td>
                  <td v-else>{{inbound.from_port}}-{{inbound.to_port}}</td>
                <!--Source IP-->
                <td v-for="s in inbound.ip_ranges">{{s.cidr_ip}}</td>
                <!--First Outbound-->
                <template v-for="outbound in rule.ip_permissions_egress" track-by="$index">
                  <td v-if="$index == 0">
                    <span v-if="outbound.ip_protocol === '-1'">
                      All
                    </span>
                    <span v-else>
                      {{outbound.ip_protocol}}
                    </span>
                  </td>
                  <td v-if="$index == 0">
                    <span v-if="outbound.from_port === outbound.to_port">
                      <span v-if="!outbound.from_port">
                        All
                      </span>
                      <span v-else>
                        {{outbound.from_port}}
                      </span>
                    </span>
                    <span v-else>
                    {{outbound.from_port}}-{{outbound.to_port}}
                    </span>
                  </td>
                  <td v-if="$index == 0">{{outbound.ip_ranges[0].cidr_ip}}</td>
                </template>
                </tr>
              </template>
              <template v-else>
                <!--next inbound-->
                <tr>
                  <td>{{inbound.ip_protocol}}</td>
                  <td v-if="inbound.from_port === inbound.to_port">
                      <span v-if="inbound.from_port === -1">
                        All
                      </span>
                      <span v-else>
                        {{inbound.from_port}}
                      </span>
                  </td>
                  <td v-else>{{inbound.from_port}}-{{inbound.to_port}}</td>
                  <!--Source IP-->
                  <td v-for="s in inbound.ip_ranges">{{s.cidr_ip}}</td>
                  <!--First Outbound-->
                  <template v-if="index < rule.ip_permissions_egress.length">
                    <td v-cloak="index === 0">
                      <span v-if="rule.ip_permissions_egress[index].ip_protocol === '-1'">
                        All
                      </span>
                      <span v-else>
                        {{rule.ip_permissions_egress[index].ip_protocol}}
                      </span>
                    </td>
                    <td v-cloak="index === 0">
                      <span v-if="rule.ip_permissions_egress[index].from_port === rule.ip_permissions_egress[index].to_port">
                        <span v-if="rule.ip_permissions_egress[index].from_port">
                          {{rule.ip_permissions_egress[index].from_port}}
                        </span><span v-else>All</span>
                      </span>
                      <span v-else>
                        {{rule.ip_permissions_egress[index].from_port}}-{{rule.ip_permissions_egress[index].to_port}}
                      </span>
                    </td>
                    <td v-cloak="index === 0">{{rule.ip_permissions_egress[index].ip_ranges[0].cidr_ip}}</td>
                  </template>
                </tr>
              </template>
            </template>
          </template>

        <!--If outbound contents is greater than inbound contents, outbound will be the base loop-->
          <template v-else>
            <template v-for="(index, outbound) in rule.ip_permissions_egress">
              <template v-if="index == 0">
                <!--First outbound-->
                <tr>
                  <!--First Outbound-->
                  <template v-for="inbound in rule.ip_permissions" track-by="$index">
                    <td v-if="$index == 0">{{inbound.ip_protocol}}</td>
                    <td v-if="$index == 0">
                      <span v-if="inbound.from_port === inbound.to_port">
                        <span v-if="inbound.from_port === -1">
                          All
                        </span>
                        <span>
                          {{inbound.from_port}}
                        </span>
                      </span>
                      <span v-else>
                        {{inbound.from_port}}-{{inbound.to_port}}
                      </span>
                    </td>
                    <td v-if="$index == 0">{{inbound.ip_ranges[0].cidr_ip}}</td>
                  </template>

                  <td>
                    <span v-if="outbound.ip_protocol === '-1'">
                      All
                    </span>
                    <span v-else>
                      {{outbound.ip_protocol}}
                    </span>
                  </td>
                  <td v-if="outbound.from_port === outbound.to_port">
                    <span v-if="!outbound.from_port">
                        All
                      </span>
                      <span v-else>
                        {{outbound.from_port}}
                      </span>
                  </td>
                  <td v-else>{{outbound.from_port}}-{{outbound.to_port}}</td>
                  <!--Source IP-->
                  <td v-for="s in outbound.ip_ranges">{{s.cidr_ip}}</td>
                </tr>
              </template>

              <template v-else>
                <!--next inbound-->
                <tr>
                  <template v-if="index < rule.ip_permissions.length">
                    <td v-cloak="index === 0">{{rule.ip_permissions[index].ip_protocol}}</td>
                    <td v-cloak="index === 0">
                      <span v-if="rule.ip_permissions[index].from_port === rule.ip_permissions[index].to_port">
                        {{rule.ip_permissions[index].from_port}}
                      </span>
                    </td>
                    <td v-cloak="index === 0">{{rule.ip_permissions[index].ip_ranges[0].cidr_ip}}</td>
                  </template>
                  <template v-else>
                    <td>-</td><td>-</td><td>-</td>
                  </template>

                  <td>{{outbound.from_port}}</td>
                  <td>{{outbound.ip_protocol}}</td>
                  <!--Source IP-->
                  <td v-for="s in outbound.ip_ranges">{{s.cidr_ip}}</td>
                  <!--First Outbound-->
                </tr>
              </template>

            </template>
          </template>

      </template>

      </tbody>
    </table>
  </div>
</div>

<div class="col-md-12 col-sm-12">
  <div v-if="!loading" class="form-actions-top">
    <button @click="show_ec2()" class="btn btn-sm btn-default"><span class="glyphicon glyphicon-arrow-left"></span> <%= t 'helpers.links.back' %></button>
  </div>
</div>
</div>
